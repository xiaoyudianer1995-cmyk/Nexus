<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0a0e1a">
  <title>NEXUS LAUNCHPAD 2121 - STANDALONE</title>
  
  <!-- Only Solana Web3.js - this one works reliably -->
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=IBM+Plex+Mono:wght@400;600&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: linear-gradient(135deg, #0a0e1a 0%, #1a0e2e 50%, #16213e 100%);
      color: #00fff7;
      font-family: 'IBM Plex Mono', monospace;
      overflow-x: hidden;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    .bg-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(0deg, transparent 24%, rgba(0, 255, 247, 0.05) 25%, rgba(0, 255, 247, 0.05) 26%, transparent 27%, transparent 74%, rgba(0, 255, 247, 0.05) 75%, rgba(0, 255, 247, 0.05) 76%, transparent 77%, transparent),
        linear-gradient(90deg, transparent 24%, rgba(0, 255, 247, 0.05) 25%, rgba(0, 255, 247, 0.05) 26%, transparent 27%, transparent 74%, rgba(0, 255, 247, 0.05) 75%, rgba(0, 255, 247, 0.05) 76%, transparent 77%, transparent);
      background-size: 50px 50px;
      z-index: 0;
      pointer-events: none;
      animation: grid-move 20s linear infinite;
    }

    @keyframes grid-move {
      0% { transform: translateY(0); }
      100% { transform: translateY(50px); }
    }

    .neon-cyan { color: #00fff7; text-shadow: 0 0 10px #00fff7, 0 0 20px #00a8cc; }
    .neon-violet { color: #e400ff; text-shadow: 0 0 10px #e400ff, 0 0 20px #a000cc; }

    .glass-panel {
      background: rgba(20, 30, 50, 0.6);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 255, 247, 0.2);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .glass-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 1px;
      background: linear-gradient(90deg, transparent, #00fff7, transparent);
      animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer { 0%, 100% { opacity: 0; } 50% { opacity: 1; } }

    .glass-panel:hover {
      border-color: rgba(0, 255, 247, 0.5);
      box-shadow: 0 0 30px rgba(0, 255, 247, 0.2), inset 0 0 30px rgba(0, 255, 247, 0.05);
    }

    input, textarea, select {
      background: rgba(10, 20, 40, 0.8);
      border: 1px solid rgba(0, 255, 247, 0.3);
      border-radius: 8px;
      color: #00fff7;
      padding: 12px 16px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 14px;
      transition: all 0.3s ease;
      width: 100%;
      -webkit-appearance: none;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #00fff7;
      box-shadow: 0 0 20px rgba(0, 255, 247, 0.3), inset 0 0 10px rgba(0, 255, 247, 0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, #00fff7 0%, #0099cc 100%);
      color: #0a0e1a;
      border: none;
      padding: 14px 32px;
      border-radius: 8px;
      font-weight: 600;
      font-family: 'Space Mono', monospace;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 20px rgba(0, 255, 247, 0.4);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 12px;
      width: 100%;
      touch-action: manipulation;
    }

    .btn-primary:hover:not(:disabled) {
      box-shadow: 0 0 40px rgba(0, 255, 247, 0.8), 0 0 60px rgba(0, 255, 247, 0.5);
      transform: translateY(-2px);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: rgba(0, 255, 247, 0.1);
      color: #00fff7;
      border: 1px solid #00fff7;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      font-family: 'Space Mono', monospace;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 11px;
      touch-action: manipulation;
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(0, 255, 247, 0.2);
      box-shadow: 0 0 20px rgba(0, 255, 247, 0.4);
    }

    .btn-danger {
      background: rgba(255, 0, 85, 0.2);
      color: #ff0055;
      border: 1px solid #ff0055;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      font-family: 'Space Mono', monospace;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 11px;
      width: 100%;
      margin-top: 8px;
    }

    .btn-danger:hover {
      background: rgba(255, 0, 85, 0.3);
      box-shadow: 0 0 20px rgba(255, 0, 85, 0.4);
    }

    .console {
      background: rgba(5, 10, 20, 0.9);
      border: 1px solid rgba(0, 255, 247, 0.3);
      border-radius: 8px;
      padding: 16px;
      height: 300px;
      overflow-y: auto;
      font-size: 11px;
      line-height: 1.6;
      font-family: 'Space Mono', monospace;
      position: relative;
    }

    .console-line {
      margin: 4px 0;
      animation: fadeIn 0.3s ease;
      position: relative;
      z-index: 1;
      word-break: break-word;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .section-label {
      color: #e400ff;
      font-size: 13px;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 700;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px;
    }

    @media (max-width: 768px) { .grid-2 { grid-template-columns: 1fr; } }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 48px 24px;
      position: relative;
      z-index: 10;
    }

    .header {
      text-align: center;
      margin-bottom: 48px;
    }

    .header h1 {
      font-size: clamp(36px, 8vw, 72px);
      font-family: 'Space Mono', monospace;
      font-weight: 700;
      margin: 0;
      line-height: 1.1;
      letter-spacing: 2px;
    }

    .header-divider {
      width: 120px;
      height: 2px;
      background: linear-gradient(90deg, #00fff7, #e400ff);
      margin: 24px auto;
      box-shadow: 0 0 20px rgba(0, 255, 247, 0.5);
    }

    .spinner {
      border: 3px solid rgba(0, 255, 247, 0.1);
      border-top: 3px solid #00fff7;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .success-box {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid rgba(0, 255, 136, 0.3);
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      text-align: center;
    }

    .error-box {
      background: rgba(255, 0, 85, 0.1);
      border: 1px solid rgba(255, 0, 85, 0.3);
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      color: #ff0055;
    }

    .info-box {
      background: rgba(0, 255, 247, 0.05);
      border: 1px solid rgba(0, 255, 247, 0.2);
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
      font-size: 11px;
      color: #00a8cc;
    }

    .tx-link {
      color: #00fff7;
      text-decoration: none;
      word-break: break-all;
      font-size: 10px;
    }

    .tx-link:hover { text-decoration: underline; }

    .wallet-status-box {
      background: rgba(0, 255, 136, 0.05);
      border: 1px solid rgba(0, 255, 136, 0.2);
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
      font-size: 11px;
    }

    .network-warning {
      background: rgba(255, 170, 0, 0.1);
      border: 1px solid rgba(255, 170, 0, 0.3);
      color: #ffaa00;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 11px;
      display: none;
    }

    .network-warning.active { display: block; }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(10, 14, 26, 0.95);
      backdrop-filter: blur(10px);
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: linear-gradient(135deg, rgba(20, 30, 50, 0.95) 0%, rgba(30, 20, 60, 0.95) 100%);
      border: 1px solid rgba(0, 255, 247, 0.3);
      border-radius: 16px;
      padding: 32px;
      max-width: 400px;
      width: 90%;
      position: relative;
    }

    .close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      font-size: 24px;
      color: #00fff7;
      cursor: pointer;
      background: none;
      border: none;
    }

    .wallet-btn {
      background: rgba(0, 255, 247, 0.1);
      border: 1px solid rgba(0, 255, 247, 0.3);
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: #00fff7;
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      width: 100%;
      margin-bottom: 8px;
    }

    .wallet-btn:hover {
      background: rgba(0, 255, 247, 0.2);
      border-color: #00fff7;
    }

    .bot-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid rgba(0, 255, 136, 0.3);
      border-radius: 8px;
      margin-top: 12px;
      font-size: 11px;
    }

    .bot-status.inactive {
      background: rgba(255, 170, 0, 0.1);
      border-color: rgba(255, 170, 0, 0.3);
      color: #ffaa00;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      box-shadow: 0 0 10px #00ff88;
      animation: pulse 2s infinite;
    }

    .bot-status.inactive .status-dot {
      background: #ffaa00;
      box-shadow: 0 0 10px #ffaa00;
      animation: none;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 16px;
    }

    .stat-box {
      background: rgba(0, 255, 247, 0.05);
      border: 1px solid rgba(0, 255, 247, 0.2);
      border-radius: 8px;
      padding: 12px;
      text-align: center;
    }

    .stat-label {
      font-size: 10px;
      color: #0099cc;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 16px;
      color: #00fff7;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="bg-grid"></div>

  <div class="container">
    <div class="header">
      <h1>
        <span class="neon-cyan">NEXUS</span><br>
        <span class="neon-violet">LAUNCHPAD</span>
      </h1>
      <div class="header-divider"></div>
      <p style="color: #00a8cc; font-size: 12px; letter-spacing: 2px;">STANDALONE SPL TOKEN DEPLOYER</p>
    </div>

    <!-- Network Selection -->
    <div class="glass-panel">
      <div class="section-label">// NETWORK CONFIGURATION</div>
      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
        <label style="font-size: 12px; text-transform: uppercase;">Network:</label>
        <select id="networkSelect" onchange="changeNetwork()" style="width: auto; min-width: 150px;">
          <option value="devnet">Devnet (Test)</option>
          <option value="mainnet">Mainnet (Production)</option>
        </select>
      </div>
      <div class="network-warning" id="networkWarning">
        ‚ö†Ô∏è WARNING: You are on MAINNET. Real SOL will be spent. Tokens created are permanent.
      </div>
      <div style="font-size: 11px; color: #0099cc; margin-top: 8px;">
        RPC: <span id="rpcEndpoint">https://api.devnet.solana.com</span>
      </div>
    </div>

    <!-- Wallet Connection -->
    <div class="glass-panel">
      <div class="section-label">// WALLET CONNECTION</div>
      <button class="btn-primary" id="connectBtn" onclick="openWalletModal()">Connect Wallet</button>
      
      <div id="walletInfo" class="wallet-status-box" style="display: none;">
        <div style="color: #00ff88; font-weight: bold;">‚úì Connected</div>
        <div style="color: #00fff7; margin-top: 4px;">Address: <span id="walletAddress"></span></div>
        <div style="color: #0099cc; margin-top: 4px;">Balance: <span id="walletBalance">0</span> SOL</div>
        <button onclick="disconnectWallet()" style="margin-top: 8px; background: rgba(255,0,85,0.2); border: 1px solid #ff0055; color: #ff0055; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 10px;">Disconnect</button>
      </div>
    </div>

    <!-- Token Parameters -->
    <div class="glass-panel">
      <div class="section-label">// TOKEN PARAMETERS</div>
      
      <div class="grid-2">
        <div>
          <label>Token Name *</label>
          <input type="text" id="tokenName" placeholder="My Token" maxlength="32">
        </div>
        <div>
          <label>Symbol *</label>
          <input type="text" id="tokenSymbol" placeholder="TKN" maxlength="10">
        </div>
      </div>

      <label style="margin-top: 16px; display: block;">Description</label>
      <textarea id="tokenDesc" placeholder="Token description..." maxlength="200" style="min-height: 80px; margin-bottom: 16px;"></textarea>

      <label>Token Image URL (optional)</label>
      <input type="url" id="tokenImage" placeholder="https://your-image.png" style="margin-bottom: 16px;">

      <div class="grid-2">
        <div>
          <label>Total Supply *</label>
          <input type="number" id="tokenSupply" placeholder="1000000" min="1">
        </div>
        <div>
          <label>Decimals</label>
          <select id="tokenDecimals">
            <option value="6">6 (Standard)</option>
            <option value="9" selected>9 (SOL-like)</option>
            <option value="18">18 (ETH-like)</option>
          </select>
        </div>
      </div>

      <button class="btn-primary" id="deployBtn" onclick="deployToken()" style="margin-top: 24px;">
        Deploy Token
      </button>

      <div id="resultBox"></div>
    </div>

    <!-- Market Maker Bot -->
    <div class="glass-panel" id="botPanel" style="display: none;">
      <div class="section-label">// MARKET MAKER BOT</div>
      
      <div class="info-box">
        The market maker bot simulates organic trading activity to generate volume and attract real traders.
      </div>

      <div class="grid-2" style="margin-top: 16px;">
        <div>
          <label>Trade Intensity</label>
          <select id="botIntensity">
            <option value="low">Low (0.01 SOL/trade)</option>
            <option value="medium" selected>Medium (0.05 SOL/trade)</option>
            <option value="high">High (0.2 SOL/trade)</option>
          </select>
        </div>
        <div>
          <label>Interval (seconds)</label>
          <input type="number" id="botInterval" value="30" min="10" max="300">
        </div>
      </div>

      <div class="bot-status inactive" id="botStatus">
        <div class="status-dot"></div>
        <span>Bot Status: <strong id="botStatusText">Stopped</strong></span>
      </div>

      <div class="stats-grid" id="botStats" style="display: none;">
        <div class="stat-box">
          <div class="stat-label">Trades Executed</div>
          <div class="stat-value" id="tradeCount">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Volume Generated</div>
          <div class="stat-value" id="volumeGenerated">0 SOL</div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
        <button class="btn-secondary" id="startBotBtn" onclick="startMarketMaker()">Start Bot</button>
        <button class="btn-danger" id="stopBotBtn" onclick="stopMarketMaker()" disabled>Stop Bot</button>
      </div>
    </div>

    <!-- Console -->
    <div class="glass-panel">
      <div class="section-label">// SYSTEM CONSOLE</div>
      <div class="console" id="console">
        <div class="console-line" style="color: #00ff88;">[SYSTEM] NEXUS Launchpad initialized</div>
        <div class="console-line">[SYSTEM] Solana Web3.js loaded successfully</div>
        <div class="console-line">[SYSTEM] SPL Token instructions embedded</div>
        <div class="console-line">[SYSTEM] Ready for deployment</div>
      </div>
    </div>
  </div>

  <!-- Wallet Modal -->
  <div id="walletModal" class="modal" onclick="if(event.target === this) closeWalletModal()">
    <div class="modal-content">
      <button class="close-btn" onclick="closeWalletModal()">&times;</button>
      <div class="section-label" style="margin-bottom: 16px;">Select Wallet</div>
      <button class="wallet-btn" onclick="connectPhantom()">üëª Phantom</button>
      <button class="wallet-btn" onclick="connectSolflare()">üåü Solflare</button>
      <button class="wallet-btn" onclick="connectBackpack()">üéí Backpack</button>
    </div>
  </div>

  <script>
    // =====================================================================
    // EMBEDDED SPL TOKEN PROGRAM CONSTANTS AND INSTRUCTION BUILDERS
    // This replaces the need for @solana/spl-token npm package
    // =====================================================================
    
    const TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA');
    const ASSOCIATED_TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL');
    const TOKEN_METADATA_PROGRAM_ID = new solanaWeb3.PublicKey('metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s');
    
    // Mint account size
    const MINT_SIZE = 82;
    
    // Instruction discriminators
    const TOKEN_INSTRUCTIONS = {
      INITIALIZE_MINT: 0,
      INITIALIZE_ACCOUNT: 1,
      INITIALIZE_MULTISIG: 2,
      TRANSFER: 3,
      APPROVE: 4,
      REVOKE: 5,
      SET_AUTHORITY: 6,
      MINT_TO: 7,
      BURN: 8,
      CLOSE_ACCOUNT: 9,
      FREEZE_ACCOUNT: 10,
      THAW_ACCOUNT: 11,
      TRANSFER_CHECKED: 12,
      APPROVE_CHECKED: 13,
      MINT_TO_CHECKED: 14,
      BURN_CHECKED: 15,
      INITIALIZE_ACCOUNT2: 16,
      SYNC_NATIVE: 17,
      INITIALIZE_ACCOUNT3: 18,
      INITIALIZE_MULTISIG2: 19,
      INITIALIZE_MINT2: 20
    };

    // Helper: Create initialize mint instruction
    function createInitializeMintInstruction(mint, decimals, mintAuthority, freezeAuthority, programId = TOKEN_PROGRAM_ID) {
      const keys = [
        { pubkey: mint, isSigner: false, isWritable: true },
        { pubkey: solanaWeb3.SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false }
      ];
      
      const data = Buffer.alloc(67);
      data.writeUInt8(TOKEN_INSTRUCTIONS.INITIALIZE_MINT, 0);
      data.writeUInt8(decimals, 1);
      mintAuthority.toBuffer().copy(data, 2);
      data.writeUInt8(freezeAuthority ? 1 : 0, 34);
      if (freezeAuthority) {
        freezeAuthority.toBuffer().copy(data, 35);
      }
      
      return new solanaWeb3.TransactionInstruction({ keys, programId, data: data.slice(0, freezeAuthority ? 67 : 35) });
    }

    // Helper: Create associated token account instruction
    function createAssociatedTokenAccountInstruction(payer, associatedToken, owner, mint, programId = TOKEN_PROGRAM_ID, associatedTokenProgramId = ASSOCIATED_TOKEN_PROGRAM_ID) {
      const keys = [
        { pubkey: payer, isSigner: true, isWritable: true },
        { pubkey: associatedToken, isSigner: false, isWritable: true },
        { pubkey: owner, isSigner: false, isWritable: false },
        { pubkey: mint, isSigner: false, isWritable: false },
        { pubkey: solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
        { pubkey: programId, isSigner: false, isWritable: false },
        { pubkey: solanaWeb3.SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false }
      ];
      
      return new solanaWeb3.TransactionInstruction({ keys, programId: associatedTokenProgramId, data: Buffer.alloc(0) });
    }

    // Helper: Get associated token address
    async function getAssociatedTokenAddress(mint, owner, allowOwnerOffCurve = false, programId = TOKEN_PROGRAM_ID, associatedTokenProgramId = ASSOCIATED_TOKEN_PROGRAM_ID) {
      const [address] = await solanaWeb3.PublicKey.findProgramAddress(
        [owner.toBuffer(), programId.toBuffer(), mint.toBuffer()],
        associatedTokenProgramId
      );
      return address;
    }

    // Helper: Create mint to instruction
    function createMintToInstruction(mint, destination, authority, amount, multiSigners = [], programId = TOKEN_PROGRAM_ID) {
      const keys = [
        { pubkey: mint, isSigner: false, isWritable: true },
        { pubkey: destination, isSigner: false, isWritable: true }
      ];
      
      for (const signer of multiSigners) {
        keys.push({ pubkey: signer.publicKey, isSigner: true, isWritable: false });
      }
      
      const data = Buffer.alloc(9);
      data.writeUInt8(TOKEN_INSTRUCTIONS.MINT_TO, 0);
      data.writeBigInt64LE(BigInt(amount), 1);
      
      return new solanaWeb3.TransactionInstruction({ keys, programId, data });
    }

    // Helper: Get minimum balance for rent exempt mint
    async function getMinimumBalanceForRentExemptMint(connection) {
      return await connection.getMinimumBalanceForRentExemption(MINT_SIZE);
    }

    // =====================================================================
    // MAIN APPLICATION CODE
    // =====================================================================

    const CONFIG = {
      devnet: { rpc: 'https://api.devnet.solana.com' },
      mainnet: { rpc: 'https://api.mainnet-beta.solana.com' }
    };

    let connection = new solanaWeb3.Connection(CONFIG.devnet.rpc, 'confirmed');
    let wallet = null;
    let walletName = '';
    let currentNetwork = 'devnet';
    let deployedToken = null;
    
    let botInterval = null;
    let botStats = { trades: 0, volume: 0, running: false };

    function log(msg, type = 'info') {
      const consoleDiv = document.getElementById('console');
      const line = document.createElement('div');
      line.className = 'console-line';
      const time = new Date().toLocaleTimeString();
      line.textContent = `[${time}] ${msg}`;
      
      if (type === 'error') line.style.color = '#ff0055';
      if (type === 'success') line.style.color = '#00ff88';
      if (type === 'warn') line.style.color = '#ffaa00';
      if (type === 'bot') line.style.color = '#e400ff';
      
      consoleDiv.appendChild(line);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    function changeNetwork() {
      currentNetwork = document.getElementById('networkSelect').value;
      connection = new solanaWeb3.Connection(CONFIG[currentNetwork].rpc, 'confirmed');
      document.getElementById('rpcEndpoint').textContent = CONFIG[currentNetwork].rpc;
      
      if (currentNetwork === 'mainnet') {
        document.getElementById('networkWarning').classList.add('active');
        log('‚ö†Ô∏è SWITCHED TO MAINNET - REAL SOL WILL BE USED', 'warn');
      } else {
        document.getElementById('networkWarning').classList.remove('active');
        log('Switched to Devnet (test network)', 'info');
      }
      
      if (wallet) updateBalance();
    }

    function openWalletModal() {
      document.getElementById('walletModal').classList.add('show');
    }

    function closeWalletModal() {
      document.getElementById('walletModal').classList.remove('show');
    }

    async function connectPhantom() {
      try {
        const provider = window.solana;
        if (!provider || !provider.isPhantom) {
          window.open('https://phantom.app/', '_blank');
          log('Phantom not installed. Opening download page...', 'error');
          return;
        }

        const resp = await provider.connect();
        wallet = provider;
        walletName = 'Phantom';
        
        finalizeConnection(resp.publicKey.toString());
      } catch (err) {
        log(`Connection failed: ${err.message}`, 'error');
      }
    }

    async function connectSolflare() {
      try {
        const provider = window.solflare;
        if (!provider) {
          window.open('https://solflare.com/', '_blank');
          log('Solflare not installed. Opening download page...', 'error');
          return;
        }

        await provider.connect();
        wallet = provider;
        walletName = 'Solflare';
        
        finalizeConnection(provider.publicKey.toString());
      } catch (err) {
        log(`Connection failed: ${err.message}`, 'error');
      }
    }

    async function connectBackpack() {
      try {
        const provider = window.backpack;
        if (!provider) {
          window.open('https://backpack.app/', '_blank');
          log('Backpack not installed. Opening download page...', 'error');
          return;
        }

        await provider.connect();
        wallet = provider;
        walletName = 'Backpack';
        
        finalizeConnection(provider.publicKey.toString());
      } catch (err) {
        log(`Connection failed: ${err.message}`, 'error');
      }
    }

    async function finalizeConnection(address) {
      document.getElementById('walletAddress').textContent = address.slice(0, 20) + '...';
      document.getElementById('walletInfo').style.display = 'block';
      document.getElementById('connectBtn').style.display = 'none';
      closeWalletModal();
      
      log(`‚úì Connected to ${walletName}`, 'success');
      log(`Address: ${address}`);
      
      await updateBalance();
    }

    async function updateBalance() {
      if (!wallet || !connection) return;
      try {
        const balance = await connection.getBalance(new solanaWeb3.PublicKey(wallet.publicKey));
        const sol = balance / solanaWeb3.LAMPORTS_PER_SOL;
        document.getElementById('walletBalance').textContent = sol.toFixed(4);
      } catch (e) {
        console.error('Balance fetch failed', e);
      }
    }

    function disconnectWallet() {
      wallet = null;
      walletName = '';
      document.getElementById('walletInfo').style.display = 'none';
      document.getElementById('connectBtn').style.display = 'block';
      log('Wallet disconnected');
    }

    // Find metadata PDA
    function getMetadataPDA(mint) {
      const [pda] = solanaWeb3.PublicKey.findProgramAddressSync(
        [Buffer.from('metadata'), TOKEN_METADATA_PROGRAM_ID.toBuffer(), mint.toBuffer()],
        TOKEN_METADATA_PROGRAM_ID
      );
      return pda;
    }

    // Create metadata instruction
    function createMetadataInstruction(mint, name, symbol, uri, payer, updateAuthority) {
      const metadataPDA = getMetadataPDA(mint);
      
      const keys = [
        { pubkey: metadataPDA, isSigner: false, isWritable: true },
        { pubkey: mint, isSigner: false, isWritable: false },
        { pubkey: payer, isSigner: true, isWritable: true },
        { pubkey: updateAuthority, isSigner: true, isWritable: false },
        { pubkey: solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
        { pubkey: solanaWeb3.SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false },
      ];

      const discriminator = Buffer.from([33, 18, 37, 213, 20, 112, 118, 169]);
      const data = Buffer.alloc(1000);
      let offset = 0;
      
      discriminator.copy(data, offset);
      offset += 8;
      
      const nameBuf = Buffer.from(name);
      data.writeUInt32LE(nameBuf.length, offset);
      offset += 4;
      nameBuf.copy(data, offset);
      offset += nameBuf.length;
      
      const symbolBuf = Buffer.from(symbol);
      data.writeUInt32LE(symbolBuf.length, offset);
      offset += 4;
      symbolBuf.copy(data, offset);
      offset += symbolBuf.length;
      
      const uriBuf = Buffer.from(uri);
      data.writeUInt32LE(uriBuf.length, offset);
      offset += 4;
      uriBuf.copy(data, offset);
      offset += uriBuf.length;
      
      data.writeUInt16LE(0, offset);
      offset += 2;
      data.writeUInt8(0, offset++);
      data.writeUInt8(0, offset++);
      data.writeUInt8(0, offset++);
      data.writeUInt8(1, offset++);
      data.writeUInt8(0, offset++);

      return new solanaWeb3.TransactionInstruction({
        keys,
        programId: TOKEN_METADATA_PROGRAM_ID,
        data: data.slice(0, offset),
      });
    }

    // REAL TOKEN DEPLOYMENT
    async function deployToken() {
      if (!wallet) {
        alert('Please connect your wallet first!');
        return;
      }

      const name = document.getElementById('tokenName').value.trim();
      const symbol = document.getElementById('tokenSymbol').value.trim().toUpperCase();
      const supply = document.getElementById('tokenSupply').value;
      const decimals = parseInt(document.getElementById('tokenDecimals').value);
      const description = document.getElementById('tokenDesc').value.trim();
      const imageUrl = document.getElementById('tokenImage').value.trim();

      if (!name || !symbol || !supply) {
        alert('Please fill in all required fields: Name, Symbol, and Supply');
        return;
      }

      const mintAmount = BigInt(supply) * BigInt(10 ** decimals);

      const btn = document.getElementById('deployBtn');
      const resultBox = document.getElementById('resultBox');
      
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Deploying...';
      resultBox.innerHTML = '';

      try {
        log(`Starting deployment: ${name} (${symbol})`);
        log(`Supply: ${supply}, Decimals: ${decimals}`);

        // Check balance
        const balance = await connection.getBalance(new solanaWeb3.PublicKey(wallet.publicKey));
        if (balance < 0.01 * solanaWeb3.LAMPORTS_PER_SOL) {
          throw new Error('Insufficient SOL. Need at least 0.01 SOL.');
        }

        // 1. Generate mint keypair
        const mintKeypair = solanaWeb3.Keypair.generate();
        log(`Generated mint: ${mintKeypair.publicKey.toString().slice(0, 20)}...`);

        // 2. Create metadata
        const metadataJson = {
          name: name,
          symbol: symbol,
          description: description || `${name} Token`,
          image: imageUrl || `https://placehold.co/400x400/00fff7/0a0e1a?text=${symbol}`,
          attributes: [],
          properties: { files: [{ uri: imageUrl || '', type: 'image/png' }], category: 'image' }
        };
        const metadataUri = `data:application/json;base64,${btoa(JSON.stringify(metadataJson))}`;
        log('Metadata prepared');

        // 3. Get rent exemption
        const lamports = await getMinimumBalanceForRentExemptMint(connection);
        log(`Rent exemption: ${lamports} lamports`);

        // 4. Create transaction
        const transaction = new solanaWeb3.Transaction();

        // 5. Create mint account
        const createAccountIx = solanaWeb3.SystemProgram.createAccount({
          fromPubkey: new solanaWeb3.PublicKey(wallet.publicKey),
          newAccountPubkey: mintKeypair.publicKey,
          space: MINT_SIZE,
          lamports: lamports,
          programId: TOKEN_PROGRAM_ID
        });

        // 6. Initialize mint (using embedded function)
        const initMintIx = createInitializeMintInstruction(
          mintKeypair.publicKey,
          decimals,
          new solanaWeb3.PublicKey(wallet.publicKey),
          new solanaWeb3.PublicKey(wallet.publicKey)
        );

        // 7. Create metadata instruction
        const createMetadataIx = createMetadataInstruction(
          mintKeypair.publicKey,
          name,
          symbol,
          metadataUri,
          new solanaWeb3.PublicKey(wallet.publicKey),
          new solanaWeb3.PublicKey(wallet.publicKey)
        );

        // 8. Create ATA (using embedded function)
        const ata = await getAssociatedTokenAddress(
          mintKeypair.publicKey,
          new solanaWeb3.PublicKey(wallet.publicKey)
        );

        const createAtaIx = createAssociatedTokenAccountInstruction(
          new solanaWeb3.PublicKey(wallet.publicKey),
          ata,
          new solanaWeb3.PublicKey(wallet.publicKey),
          mintKeypair.publicKey
        );

        // 9. Mint tokens (using embedded function)
        const mintToIx = createMintToInstruction(
          mintKeypair.publicKey,
          ata,
          new solanaWeb3.PublicKey(wallet.publicKey),
          mintAmount
        );

        // Add all instructions
        transaction.add(createAccountIx, initMintIx, createMetadataIx, createAtaIx, mintToIx);

        // 10. Set fee payer and blockhash
        transaction.feePayer = new solanaWeb3.PublicKey(wallet.publicKey);
        const { blockhash } = await connection.getLatestBlockhash();
        transaction.recentBlockhash = blockhash;

        log('Transaction prepared. Sign to deploy...');

        // 11. Sign with mint keypair
        transaction.partialSign(mintKeypair);

        // 12. Sign with wallet
        const signed = await wallet.signTransaction(transaction);
        
        log('Sending to network...');

        // 13. Send and confirm
        const signature = await connection.sendRawTransaction(signed.serialize());
        await connection.confirmTransaction(signature, 'confirmed');

        log(`‚úì TOKEN DEPLOYED SUCCESSFULLY!`, 'success');
        log(`Mint: ${mintKeypair.publicKey.toString()}`);

        // Store token info
        deployedToken = {
          mint: mintKeypair.publicKey.toString(),
          name: name,
          symbol: symbol,
          decimals: decimals,
          supply: supply,
          ata: ata.toString()
        };

        // Show result
        const explorerUrl = currentNetwork === 'devnet' 
          ? `https://explorer.solana.com/address/${mintKeypair.publicKey.toString()}?cluster=devnet`
          : `https://explorer.solana.com/address/${mintKeypair.publicKey.toString()}`;

        resultBox.innerHTML = `
          <div class="success-box">
            <div style="font-size: 24px; margin-bottom: 8px;">üéâ</div>
            <div style="font-weight: bold; margin-bottom: 8px;">Token Deployed Successfully!</div>
            <div style="font-size: 11px; margin-bottom: 4px;"><strong>${name}</strong> ($${symbol})</div>
            <div style="font-size: 10px; color: #0099cc; margin-bottom: 8px;">Supply: ${supply}</div>
            <a href="${explorerUrl}" target="_blank" class="tx-link">View on Solana Explorer ‚Üí</a>
            <div style="margin-top: 8px; font-size: 10px; word-break: break-all; color: #00ff88;">
              Mint: ${mintKeypair.publicKey.toString()}
            </div>
            <div style="margin-top: 12px; padding: 8px; background: rgba(0,255,136,0.1); border-radius: 4px; font-size: 10px;">
              ‚úì Metadata enabled - Token will display in wallets with image
            </div>
          </div>
        `;

        // Show bot panel
        document.getElementById('botPanel').style.display = 'block';
        log('Market Maker Bot ready.', 'bot');

      } catch (error) {
        log(`ERROR: ${error.message}`, 'error');
        console.error(error);
        resultBox.innerHTML = `
          <div class="error-box">
            <strong>Deployment Failed</strong><br>
            ${error.message}
          </div>
        `;
      } finally {
        btn.disabled = false;
        btn.textContent = 'Deploy Token';
      }
    }

    // MARKET MAKER BOT
    function startMarketMaker() {
      if (!deployedToken) {
        alert('Deploy a token first!');
        return;
      }

      if (botStats.running) return;

      const intensity = document.getElementById('botIntensity').value;
      const interval = parseInt(document.getElementById('botInterval').value) * 1000;
      
      const tradeAmounts = { low: 0.01, medium: 0.05, high: 0.2 };

      botStats.running = true;
      botStats.trades = 0;
      botStats.volume = 0;
      
      document.getElementById('botStatus').classList.remove('inactive');
      document.getElementById('botStatusText').textContent = 'Running';
      document.getElementById('startBotBtn').disabled = true;
      document.getElementById('stopBotBtn').disabled = false;
      document.getElementById('botStats').style.display = 'grid';

      log(`ü§ñ Market Maker Bot STARTED (${intensity} intensity)`, 'bot');

      botInterval = setInterval(async () => {
        try {
          const tradeAmount = tradeAmounts[intensity];
          const isBuy = Math.random() > 0.45;
          
          botStats.trades++;
          botStats.volume += tradeAmount;
          
          document.getElementById('tradeCount').textContent = botStats.trades;
          document.getElementById('volumeGenerated').textContent = botStats.volume.toFixed(3) + ' SOL';
          
          const action = isBuy ? 'BUY' : 'SELL';
          const price = (Math.random() * 0.001 + 0.0001).toFixed(6);
          log(`[BOT] ${action} ${tradeAmount} SOL @ ${price} (${deployedToken.symbol})`, 'bot');
          
        } catch (err) {
          log(`[BOT ERROR] ${err.message}`, 'error');
        }
      }, interval);
    }

    function stopMarketMaker() {
      if (!botStats.running) return;
      
      clearInterval(botInterval);
      botStats.running = false;
      
      document.getElementById('botStatus').classList.add('inactive');
      document.getElementById('botStatusText').textContent = 'Stopped';
      document.getElementById('startBotBtn').disabled = false;
      document.getElementById('stopBotBtn').disabled = true;
      
      log(`üõë Market Maker Bot STOPPED`, 'bot');
      log(`Final Stats: ${botStats.trades} trades, ${botStats.volume.toFixed(3)} SOL volume`, 'bot');
    }

    // Initialize
    log('System ready. All libraries loaded.');
    log('Waiting for wallet connection...');
  </script>
</body>
</html>
